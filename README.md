## Create a virtual environement and install required libraries

1. Create a virual environment with `python3 -m venv venv`
2. Activate it with `source venv/bin/activate`
3. Install dependencies `pip3 install -r requirements.txt`

You must use Python version `3.11`, or lower, othewsie it won't work with some outdated dependencies. To control Python versions you may use the `pyenv` tool.

1. `brew install pyenv`
2. `pyenv install 3.11.0`
3. `pyenv global 3.11.0` to set globally or `pyenv local 3.11.0` to set in the current directory.

In the case this tools doesn't change your Python version (happens on an M-chip Mac), add `eval "$(pyenv init --path)"` to your ~/.zshrc and re-open the terminal.

## Running the server

Run the program with `python3 run.py`

## Editing the data, i.e. modules and positions/rotations

See the `data.json` and `data_2.json` files.

### New ideas/discussions

- What's the effective startegy for routing?
  (1) Algorithmic - path finding for every net [go for this]
  (2) Parametric/pre-defined - having routes go up/down, connect to a bus, or other consistent method
- How much do we care about modularity for other types of boards, apart from the micro:bit?
- Programming layer
  (a) What's the approach going to be
  (b) Impedence matched programming/debug lines?
  (c) Any additional hardware/button that will need to be places in the design?
- BOM generation and pick & place files
- Use GerberSocket layer to define apertures for 3D prints
- Thinking about the next step of MakeDevice i.e. removing the MCUs
  (a) MakeDevice should know about which components go together, there needs to metadata
  (b) Tiers of modules
  (1) Physical Jacdac modules that have a virtual mounting footprint
  (2) Virtual Jacdac modules, simply flattened (we are working on it now)
  (3) Virtual modules without MCUs, one central brain component

### Progress

1. Fixed issues with generated traces cutting through the keep-out zones, particularly top and right side of the keep-out zones
2. Fixed A\* search algorithm for pathfinding
3. Implemented diagonal routing, breadth first search creates noticebly cleaner traces
4. New layer_mappings parameters passed into generate_gebrer script, which specify which net goes on which layer
5. Implemented detection of intersection
6. Now removes traces that overlap on top of each other, entirely or partially
7. Segment splitting (removing the old segment at the intersection and insering two new ones)

### Issues TO FIX

**Wed 15 Jan, 2025**

- [x] When extracting sockets, the location was getting rounded to the nearest grid resolution value, therefore locations of sockets are accurately detected
- [x] The keep-out zone extraction has incorrect coordinates for the top-right corner
- [x] Not checking if the route goes inside of a keep-out zone when the route moves diagonally
- [x] Fix the strategy with the keep-out zones if the margin is > 0, when routing a net, remove the keepout area of the margin around the current sockets
- [x] Remove breadth-first-search as it is less efficient
- [x] Temporary keep-out zones for vias are smaller for left and bottom located vias, and right and top are too large

- [ ] Fix up the way layer mappings are passed onto the generate, maybe the EMPTY net is not necessary to put through
- [ ] When setting the grid resolution to 0.1, it doesn't work when it does work in 1 grid resolution.
- [ ] When adding an unknown (debug.gbr) file to /output directory, this resulted in double the amount of merged files (happened twice nad not again later???)
- [ ] When a route exists/enters a socket keep-out zone, it goes directly out, rather than diagonally, or just to the closest line
- [ ] Check the logoci for merging with the closest trace on the same net
- [ ] Improve layer mappings, and set it up so that you can pass which layer

### A new idea to store information about each module in a JSON

A unique JSOn file for each module which could be generated by a separate web application (could even annotate it there).

- Module description & name?
- Which layers it uses/how many 2/4
- Path/names for the `.wrl` files, gerbers, `.gltf`, and other
- Perhaps information about the 3D shapes, or its apertures
- EC30 size information
- Available services?
